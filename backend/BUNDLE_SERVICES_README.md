# Управление услугами в форматах отдыха

## Обзор

Карточка Формата отдыха в админке теперь имеет полноценную возможность комплектоваться услугами на выбор администратора.

## Функционал

### 1. Форма редактирования формата отдыха

**Секция "Включённые услуги":**
- ✅ **Множественный выбор услуг** - можно выбрать несколько услуг для одного формата отдыха
- ✅ **Поиск по названию** - быстрый поиск услуг по названию
- ✅ **Предзагрузка** - все услуги загружаются заранее для быстрого доступа
- ✅ **Описание секции** - понятное объяснение назначения
- ✅ **Подсказки** - помощь пользователю в работе с интерфейсом

**Информационная панель:**
- ✅ **Счетчик услуг** - показывает количество выбранных услуг
- ✅ **Список услуг** - отображает названия всех выбранных услуг
- ✅ **Описания услуг** - показывает описания выбранных услуг
- ✅ **Динамическое обновление** - информация обновляется при изменении выбора

### 2. Таблица бандлов

**Колонка "Услуг":**
- ✅ **Цветные бейджи** - визуальная индикация количества услуг:
  - Серый: 0 услуг
  - Желтый: 1-2 услуги  
  - Зеленый: 3+ услуг
- ✅ **Счетчик услуг** - точное количество услуг в бандле

**Колонка "Услуги":**
- ✅ **Список услуг** - показывает названия первых 3 услуг
- ✅ **Сокращение** - "и ещё X" для бандлов с большим количеством услуг
- ✅ **Подсказка** - полный список услуг при наведении
- ✅ **Поиск** - можно искать бандлы по названиям услуг
- ✅ **Переключаемая** - колонку можно скрыть/показать

### 3. Фильтрация

**Фильтр по количеству услуг:**
- ✅ **Без услуг** - бандлы без привязанных услуг
- ✅ **1-2 услуги** - бандлы с небольшим количеством услуг
- ✅ **3-5 услуг** - бандлы со средним количеством услуг
- ✅ **6+ услуг** - бандлы с большим количеством услуг

## Примеры использования

### Создание базового формата отдыха
1. Откройте админку → Форматы отдыха → Создать
2. Заполните основную информацию (название, ночи, цена)
3. В секции "Включённые услуги" выберите 2-3 основные услуги
4. Сохраните формат отдыха

### Создание премиум формата отдыха
1. Создайте формат отдыха с большим количеством ночей и высокой ценой
2. Выберите все доступные услуги (5+ услуг)
3. Формат отдыха автоматически получит зеленый бейдж "Услуг"

### Фильтрация форматов отдыха
1. Используйте фильтр "Количество услуг" для поиска:
   - Базовых форматов отдыха (1-2 услуги)
   - Премиум форматов отдыха (6+ услуг)
   - Неполных форматов отдыха (без услуг)

## Технические детали

### Модель Bundle
```php
public function services()
{
    return $this->belongsToMany(Service::class, 'bundle_service')->withTimestamps();
}
```

### Таблица bundle_service
- `bundle_id` → `bundles.id` (CASCADE)
- `service_id` → `services.id` (CASCADE)
- Уникальный индекс: `['bundle_id', 'service_id']`

### Безопасность
- ✅ **CASCADE удаление** - при удалении бандла или услуги связи удаляются автоматически
- ✅ **Валидация** - проверка существования услуг при сохранении
- ✅ **Целостность данных** - внешние ключи обеспечивают целостность

## Тестирование

Созданы тестовые данные:
- **5 услуг:** Конные прогулки, Катание на санях, Фотосессия, Обучение верховой езде, Кормление лошадей
- **2 бандла:** 
  - "Тест" (3 услуги)
  - "Премиум пакет" (5 услуг)

## Доступ

- **URL:** `/admin/bundles`
- **Права:** Требуется авторизация в админке
- **Роли:** Доступно всем авторизованным пользователям админки




